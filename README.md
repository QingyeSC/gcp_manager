# GCPè´¦å·ç®¡ç†ç³»ç»Ÿ (Dockerç‰ˆæœ¬)

ä¸€ä¸ªåŸºäºDockerçš„å®Œæ•´GCPæœåŠ¡è´¦å·è‡ªåŠ¨åŒ–ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œé›†æˆMySQLæ•°æ®åº“ã€Redisç¼“å­˜ã€Webç®¡ç†ç•Œé¢å’Œè‡ªåŠ¨ç›‘æ§ç³»ç»Ÿã€‚

## ğŸ¯ ç³»ç»Ÿç‰¹æ€§

- **ğŸ³ DockeråŒ–éƒ¨ç½²**: ä¸€é”®éƒ¨ç½²ï¼Œå¼€ç®±å³ç”¨
- **ğŸ—„ï¸ MySQLæ•°æ®åº“**: æŒä¹…åŒ–å­˜å‚¨ï¼Œæ”¯æŒé›†ç¾¤
- **âš¡ Redisç¼“å­˜**: é«˜æ€§èƒ½ä¼šè¯ç®¡ç†å’Œç¼“å­˜
- **ğŸŒ Webç®¡ç†ç•Œé¢**: ç›´è§‚çš„è´¦å·ç®¡ç†é¢æ¿
- **ğŸ¤– è‡ªåŠ¨ç›‘æ§**: å®æ—¶ç›‘æ§New APIçŠ¶æ€ï¼Œæ™ºèƒ½è¡¥å……æ¸ é“
- **ğŸ“Š çŠ¶æ€ç®¡ç†**: å®Œæ•´çš„è´¦å·ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **ğŸ”§ å¤šè¿›ç¨‹æ¶æ„**: ç›‘æ§ã€Webé¢æ¿ã€è°ƒåº¦å™¨ç‹¬ç«‹è¿è¡Œ
- **ğŸ“ˆ å¥åº·æ£€æŸ¥**: å®Œæ•´çš„æœåŠ¡å¥åº·ç›‘æ§

## ğŸ“ é¡¹ç›®ç»“æ„

```
gcp_account_manager/
â”œâ”€â”€ docker-compose.yml          # Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ Dockerfile                  # åº”ç”¨é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”œâ”€â”€ accounts/                  # è´¦å·æ–‡ä»¶å­˜å‚¨ï¼ˆæŒ‚è½½å·ï¼‰
â”‚   â”œâ”€â”€ fresh/                # æ–°è´¦å·æ± 
â”‚   â”œâ”€â”€ uploaded/             # å·²ä¸Šä¼ ä½¿ç”¨ä¸­
â”‚   â”œâ”€â”€ exhausted_300/        # 300åˆ€ç”¨å®Œï¼Œå¾…æ¿€æ´»
â”‚   â”œâ”€â”€ activated/            # å·²æ¿€æ´»è´¦å·
â”‚   â”œâ”€â”€ exhausted_100/        # 100åˆ€ç”¨å®Œ
â”‚   â””â”€â”€ archive/              # å½’æ¡£è´¦å·
â”œâ”€â”€ scripts/                  # æ ¸å¿ƒè„šæœ¬
â”‚   â”œâ”€â”€ monitor.py           # ç›‘æ§è„šæœ¬
â”‚   â””â”€â”€ scheduler.py         # è°ƒåº¦è„šæœ¬
â”œâ”€â”€ app.py                   # Webåº”ç”¨ä¸»æ–‡ä»¶
â”œâ”€â”€ templates/               # Webæ¨¡æ¿
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ settings.json       # ä¸»é…ç½®
â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶ï¼ˆæŒ‚è½½å·ï¼‰
â”œâ”€â”€ docker/                  # Dockeré…ç½®
â”‚   â”œâ”€â”€ entrypoint.sh       # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ supervisord.conf    # è¿›ç¨‹ç®¡ç†é…ç½®
â”‚   â””â”€â”€ healthcheck.py      # å¥åº·æ£€æŸ¥è„šæœ¬
â”œâ”€â”€ mysql/                   # MySQLé…ç½®
â”‚   â”œâ”€â”€ init/               # åˆå§‹åŒ–SQLè„šæœ¬
â”‚   â””â”€â”€ conf/               # é…ç½®æ–‡ä»¶
â””â”€â”€ nginx/                   # Nginxé…ç½®
    â””â”€â”€ nginx.conf          # åå‘ä»£ç†é…ç½®
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ‚¨çš„æœåŠ¡å™¨å·²å®‰è£…ï¼š
- Docker (20.10+)
- Docker Compose (2.0+)

```bash
# æ£€æŸ¥Dockerç‰ˆæœ¬
docker --version
docker-compose --version
```

### 2. è·å–é¡¹ç›®æ–‡ä»¶

```bash
# ä¸‹è½½é¡¹ç›®æ–‡ä»¶åˆ°æœåŠ¡å™¨
cd /opt
git clone <your-repo-url> gcp_account_manager
cd gcp_account_manager
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env
```

**é‡è¦é…ç½®é¡¹ï¼š**
```bash
# æ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=your_secure_root_password
MYSQL_PASSWORD=your_secure_password

# New APIé…ç½®
NEW_API_BASE_URL=http://152.53.166.175:3058
NEW_API_TOKEN=your_new_api_token_here

# å®‰å…¨é…ç½®
SECRET_KEY=your_very_secure_secret_key_here
REDIS_PASSWORD=your_redis_password_here
```

### 4. å‡†å¤‡è´¦å·æ–‡ä»¶

å°†æ‚¨çš„GCPæœåŠ¡è´¦å·JSONæ–‡ä»¶æ”¾å…¥ç›¸åº”ç›®å½•ï¼š

```bash
# åˆ›å»ºè´¦å·ç›®å½•
mkdir -p accounts/fresh

# å¤åˆ¶JSONæ–‡ä»¶åˆ°freshç›®å½•
# æ–‡ä»¶å‘½åæ ¼å¼: proj-è´¦å·å-vip-01.json, proj-è´¦å·å-vip-02.json, proj-è´¦å·å-vip-03.json
cp /path/to/your/json/files/* accounts/fresh/
```

### 5. å¯åŠ¨ç³»ç»Ÿ

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 6. è®¿é—®ç³»ç»Ÿ

- **Webç®¡ç†ç•Œé¢**: http://your-server-ip:5000
- **Nginxä»£ç†** (å¦‚æœå¯ç”¨): http://your-server-ip
- **æ•°æ®åº“**: your-server-ip:3306
- **Redis**: your-server-ip:6379

## ğŸ“Š æœåŠ¡æ¶æ„

### æ ¸å¿ƒæœåŠ¡

1. **MySQLæ•°æ®åº“**
   - å­˜å‚¨è´¦å·çŠ¶æ€å’Œå†å²è®°å½•
   - æŒä¹…åŒ–é…ç½®ä¿¡æ¯
   - æ”¯æŒè¿æ¥æ± å’Œé›†ç¾¤

2. **Redisç¼“å­˜**
   - ä¼šè¯å­˜å‚¨
   - ç¼“å­˜å¸¸ç”¨æ•°æ®
   - æå‡æ€§èƒ½

3. **åº”ç”¨æœåŠ¡**
   - **ç›‘æ§è¿›ç¨‹**: è‡ªåŠ¨æ£€æµ‹å’Œè¡¥å……æ¸ é“
   - **Webç•Œé¢**: è´¦å·ç®¡ç†å’ŒçŠ¶æ€å±•ç¤º
   - **è°ƒåº¦å™¨**: å®šæ—¶ä»»åŠ¡å’Œæ¸…ç†å·¥ä½œ

4. **Nginxåå‘ä»£ç†** (å¯é€‰)
   - è´Ÿè½½å‡è¡¡
   - SSLç»ˆæ­¢
   - é™æ€æ–‡ä»¶æœåŠ¡

## ğŸ› ï¸ ç®¡ç†æ“ä½œ

### æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs monitor
docker-compose logs web_panel
docker-compose logs mysql

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f gcp_manager
```

### å¤‡ä»½å’Œæ¢å¤

```bash
# å¤‡ä»½æ•°æ®åº“
docker-compose exec mysql mysqldump -u root -p gcp_accounts > backup.sql

# å¤‡ä»½è´¦å·æ–‡ä»¶
tar -czf accounts_backup.tar.gz accounts/

# æ¢å¤æ•°æ®åº“
docker-compose exec -T mysql mysql -u root -p gcp_accounts < backup.sql
```

### æ›´æ–°ç³»ç»Ÿ

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose down
docker-compose up -d --build
```

### æ‰©å±•éƒ¨ç½²

```bash
# æ‰©å±•åº”ç”¨å®ä¾‹
docker-compose up -d --scale gcp_manager=3

# æŸ¥çœ‹æ‰©å±•çŠ¶æ€
docker-compose ps
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `NEW_API_BASE_URL` | New APIæœåŠ¡å™¨åœ°å€ | - |
| `NEW_API_TOKEN` | APIè®¿é—®ä»¤ç‰Œ | - |
| `MIN_CHANNELS` | æœ€å°æ¸ é“æ•°é‡ | 10 |
| `TARGET_CHANNELS` | ç›®æ ‡æ¸ é“æ•°é‡ | 15 |
| `CHECK_INTERVAL` | æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ | 300 |
| `MYSQL_ROOT_PASSWORD` | MySQL rootå¯†ç  | - |
| `MYSQL_PASSWORD` | åº”ç”¨æ•°æ®åº“å¯†ç  | - |
| `REDIS_PASSWORD` | Rediså¯†ç  | - |
| `SECRET_KEY` | Webåº”ç”¨å¯†é’¥ | - |

### æ•°æ®åº“é…ç½®

MySQLæ”¯æŒä»¥ä¸‹ä¼˜åŒ–é…ç½®ï¼š
- è¿æ¥æ± å¤§å°ï¼š10-20
- æŸ¥è¯¢ç¼“å­˜ï¼š64MB
- InnoDBç¼“å†²æ± ï¼š256MB
- æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šå¯ç”¨

### ç›‘æ§é…ç½®

ç³»ç»Ÿæä¾›å¤šå±‚ç›‘æ§ï¼š
- å®¹å™¨å¥åº·æ£€æŸ¥
- åº”ç”¨å¥åº·æ£€æŸ¥ç«¯ç‚¹
- æ•°æ®åº“è¿æ¥ç›‘æ§
- æ–‡ä»¶ç³»ç»Ÿç›‘æ§

## ğŸ“± Webç•Œé¢åŠŸèƒ½

### ä»ªè¡¨æ¿é¡µé¢
- ğŸ“Š å®æ—¶ç³»ç»ŸçŠ¶æ€ç»Ÿè®¡
- ğŸ”„ æ¸ é“çŠ¶æ€æ€»è§ˆ
- âš¡ å¿«é€Ÿæ“ä½œå…¥å£
- ğŸ“ˆ å†å²è¶‹åŠ¿å›¾è¡¨

### å¾…æ¿€æ´»è´¦å·ç®¡ç†
- ğŸ“‹ å¾…æ¿€æ´»è´¦å·åˆ—è¡¨
- âœ… æ‰¹é‡æ¿€æ´»æ“ä½œ
- ğŸ“ æ¿€æ´»çŠ¶æ€è·Ÿè¸ª
- ğŸ’° é¢åº¦ä½¿ç”¨æƒ…å†µ

### è´¦å·æ¸…ç†ç®¡ç†
- ğŸ—‘ï¸ ç”¨å®Œè´¦å·æ¸…ç†
- ğŸ“¦ æ‰¹é‡å½’æ¡£æ“ä½œ
- ğŸ” è¯¦ç»†ä½¿ç”¨è®°å½•
- ğŸ’¾ å­˜å‚¨ç©ºé—´ç®¡ç†

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. æœåŠ¡å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E ':(3306|5000|6379)'

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose logs service_name
```

**2. æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
docker-compose exec mysql mysqladmin ping -h localhost

# é‡ç½®æ•°æ®åº“å¯†ç 
docker-compose exec mysql mysql -u root -p
```

**3. è´¦å·ä¸Šä¼ å¤±è´¥**
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker-compose exec gcp_manager curl -I http://152.53.166.175:3058

# éªŒè¯JSONæ–‡ä»¶æ ¼å¼
python -m json.tool accounts/fresh/example.json
```

**4. Webç•Œé¢æ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥ç«¯å£æ˜ å°„
docker-compose port gcp_manager 5000

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
sudo ufw status
```

### æ€§èƒ½ä¼˜åŒ–

**1. æ•°æ®åº“ä¼˜åŒ–**
```sql
-- æŸ¥çœ‹è¿æ¥æ•°
SHOW PROCESSLIST;

-- æŸ¥çœ‹ç¼“å­˜å‘½ä¸­ç‡
SHOW STATUS LIKE 'Qcache%';

-- åˆ†ææ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log ORDER BY start_time DESC LIMIT 10;
```

**2. åº”ç”¨ä¼˜åŒ–**
- å¢åŠ æ£€æŸ¥é—´éš”å‡å°‘èµ„æºæ¶ˆè€—
- ä½¿ç”¨Redisç¼“å­˜é¢‘ç¹æŸ¥è¯¢
- å®šæœŸæ¸…ç†å†å²æ—¥å¿—

**3. å®¹å™¨ä¼˜åŒ–**
```yaml
# docker-compose.ymlä¸­æ·»åŠ èµ„æºé™åˆ¶
services:
  gcp_manager:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **æ›´æ”¹é»˜è®¤å¯†ç **: ä½¿ç”¨å¼ºå¯†ç æ›¿æ¢æ‰€æœ‰é»˜è®¤å¯†ç 
2. **ç½‘ç»œéš”ç¦»**: ä½¿ç”¨é˜²ç«å¢™é™åˆ¶ä¸å¿…è¦çš„ç«¯å£è®¿é—®
3. **SSL/TLS**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨HTTPS
4. **å®šæœŸå¤‡ä»½**: å»ºç«‹è‡ªåŠ¨å¤‡ä»½ç­–ç•¥
5. **æ—¥å¿—ç›‘æ§**: é…ç½®æ—¥å¿—å‘Šè­¦å’Œåˆ†æ
6. **æƒé™æ§åˆ¶**: é™åˆ¶å®¹å™¨è¿è¡Œæƒé™

## ğŸ“ˆ ç›‘æ§å’Œå‘Šè­¦

### ç³»ç»Ÿç›‘æ§
- CPUå’Œå†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ç©ºé—´å ç”¨
- ç½‘ç»œè¿æ¥çŠ¶æ€
- æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡

### ä¸šåŠ¡ç›‘æ§
- æ¸ é“å¯ç”¨æ•°é‡
- è´¦å·æ¿€æ´»æˆåŠŸç‡
- ä¸Šä¼ å¤±è´¥ç‡
- å“åº”æ—¶é—´

### å‘Šè­¦é…ç½®
å¯ä»¥é›†æˆä»¥ä¸‹å‘Šè­¦æ–¹å¼ï¼š
- é‚®ä»¶é€šçŸ¥
- Telegram Bot
- Slackæ¶ˆæ¯
- Webhookå›è°ƒ

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸæ£€æŸ¥**: æ¯å¤©æ£€æŸ¥å¾…æ¿€æ´»è´¦å·çŠ¶æ€
2. **æ‰¹é‡æ“ä½œ**: åˆ©ç”¨æ‰¹é‡åŠŸèƒ½æé«˜æ•ˆç‡
3. **æ–‡ä»¶å¤‡ä»½**: é‡è¦æ“ä½œå‰å¤‡ä»½è´¦å·æ–‡ä»¶
4. **ç›‘æ§å‘Šè­¦**: é…ç½®ä½æ¸ é“æ•°å‘Šè­¦
5. **æ—¥å¿—åˆ†æ**: å®šæœŸåˆ†ææ—¥å¿—å‘ç°é—®é¢˜
6. **æ€§èƒ½è°ƒä¼˜**: æ ¹æ®ä½¿ç”¨æƒ…å†µè°ƒæ•´é…ç½®

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜è¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤Issueåˆ°é¡¹ç›®ä»“åº“
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—æ–‡ä»¶
- å‚è€ƒæ•…éšœæ’é™¤æ–‡æ¡£

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºMITè®¸å¯è¯å¼€æºã€‚